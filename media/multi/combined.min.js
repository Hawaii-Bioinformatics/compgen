"use strict";var visualize=(function(){var d,l,L,a,p,q,C,t,m=[],j=false,E=[],s=[],u={},N=[],o={},J=0,x=0,i={},D={},A=[],H=[1,1],r=d3.select(document.getElementById("toolTip")),e=d3.select(document.getElementById("head")),y=d3.select(document.getElementById("header1")),w=d3.select(document.getElementById("header2")),P={},z="#447733",n="#F80018",O="#0543EE";function k(Q){}function g(){return[J,x]}function b(Q,R){J=parseInt(Q);x=parseInt(R)}function F(){d3.select("#svg").remove();d="",l="",L="",a="",p="",q="",C="",t=0,o={},i={},D={},A=[],P={}}function K(S){function R(aa,X){var Z={},W=X-aa+1;if(W<=0){W=1}var V=0.95/W,Y=0;Y=V;for(var U=aa;U<=X;++U){Z[U]=Y;Y+=V}return Z}var Q=g(),T=R(Q[0],Q[1]);u={};m.forEach(function(V){if(V[1]>=Q[0]&&V[1]<=Q[1]){var U={value:V[2],opacity:T[V[1]],cluster_id:V[0],member_count:V[1]};u[U.cluster_id]=U}})}function I(R,Q){if(Q=="NODE"){if(R.depth<1){return}r.transition().duration(200).style("opacity","1");y.text("Cluster: "+R.cluster_id);e.text("Members: "+Number(R.member_count).toLocaleString());w.text("Non-Unique Members : "+Number(R.value).toLocaleString());r.style("left",(d3.event.pageX+50)+"px").style("top",(d3.event.pageY-125)+"px").style("height","80px").style("background-color","#FFFFFF").style("border"," solid black 1px").style("border-radius","5px").style("z-index",999);h(R,true,Q,Q+"_"+R.cluster_id)}else{if(Q=="MEMBER"){h(i[R],true,Q,Q+"_"+R)}}}function M(R,Q){if(Q=="NODE"){h(R,false,Q,"")}else{if(Q=="MEMBER"){h(i[R],false,Q,"")}}r.transition().duration(500).style("opacity","0").style("z-index",-999)}function v(S,U,V){var T=((U==true)?((V=="MEMBER")?0.2:0.8):0),W=((U==true)?((V=="MEMBER")?0.1:0.8):0),X=d3.select(document.getElementById("l_"+S.Key)),Y=d3.select(document.getElementById("p_"+S.name)),Q=d3.select(document.getElementById("c_"+S.cluster_id)),R=(U==true)?150:550;X.transition(R).style("fill-opacity",T).style("stroke-opacity",W);Y.transition(R).style("fill",(U==true)?z:"#000");Q.transition(R).style("fill",(U==true)?z:n).style("fill-opacity",(U==true)?1:u[S.cluster_id].opacity)}function h(T,Q,S,R){if(!(R in o)&&Q==true){o[R]=true;G(T.relatedLinks)}T.relatedLinks.forEach(function(U){v(U,Q,S)})}function G(Q){var S=d3.svg.diagonal.radial(),T=l.selectAll("g.links").data(Q,function(W,V){return W.Key}),U=T.enter();U.append("path").attr("class","link links").attr("id",function(V){return"l_"+V.Key}).attr("d",function(Y,W){var V="diag_"+Y.name+"_"+Y.cluster_id;if(!(V in Y)){Q=R(Y);var X=S(Q[0],W);X+="L"+String(S(Q[1],W)).substr(1);X+="A"+p+","+p+" 0 0,0 "+Q[0].source.x+","+Q[0].source.y;Y[V]=X}return Y[V]}).style("stroke",function(V){return O}).style("stroke-width",0.5).style("stroke-opacity",0).style("fill-opacity",0).style("fill",function(V){return O});function R(Z){var Y={},X={},W=D[Z.cluster_id],V=i[Z.name].currentLinkAngle-1.5;X.x=(p*Math.cos(V));X.y=(p*Math.sin(V));Y.x=W.x-(C-q);Y.y=W.y-(C-q);return[{source:X,target:Y},{source:Y,target:X}]}T.exit().remove()}function f(V){var R=d3.layout.pack().sort(null).size([V*2,V*2]).padding(1.5),W=[];for(var T in u){W.push(u[T])}var Q={children:W,PTY:"root"},S=R.nodes(Q);N=[];S.forEach(function(X){if(X.depth==1){D[X.cluster_id]=X;X.relatedLinks=[];N.push(X)}});U();s.forEach(function(X){if(X.cluster_id in D){X.name=E[X.member_id].name;D[X.cluster_id].relatedLinks.push(X);i[X.name].relatedLinks.push(X)}});function U(){var Y=[],X={},Z=[],ab=0,aa=d3.layout.chord().padding(0.05).sortSubgroups(d3.descending).sortChords(d3.descending);E.forEach(function(ac){ac=ac.name;if(!(ac in X)){Z[ab]=ac;X[ac]=ab++}});E.forEach(function(ae){var ac=X[ae.name],ad=Y[ac];if(!ad){Y[ac]=Array.apply(null,new Array(ab)).map(Number.prototype.valueOf,0);ad=Y[ac]}ad[X[ae.name]]=1});ab=0;aa.matrix(Y);A=aa.chords();A.forEach(function(ac){ac.label=Z[ab];ac.angle=(ac.source.startAngle+ac.source.endAngle)/2;i[ac.label]={startAngle:ac.source.startAngle,endAngle:ac.source.endAngle,index:ac.source.index,value:ac.source.value,currentAngle:ac.source.startAngle,currentLinkAngle:ac.source.startAngle,source:ac.source,relatedLinks:[]};ab++})}}function c(){var T=(Math.max(600,Math.min(screen.height,screen.width)-250))/2,V=T-120,R=V-50;q=(T-V)+(V-R)+100,C=(T+100);p=V-20;d=d3.select(document.getElementById("svgDiv")).style("width",(T*2+200)+"px").style("height",(T*2+200)+"px").append("svg").attr("id","svg").style("width",(T*2+200)+"px").style("height",(T*2+200)+"px"),l=d.append("g").attr("class","links").attr("transform","translate("+C+","+C+")"),L=d.append("g").attr("class","nodes").attr("transform","translate("+q+","+q+")"),a=d.append("g").attr("class","chords").attr("transform","translate("+C+","+C+")"),d3.select(document.getElementById("mainDiv")).style("width",(T*2+400)+"px").style("height",(T*2+400)+"px");d3.select(document.getElementById("bpg")).style("width",(T*2+400)+"px");f(R);S();U(V);Q();$("#minv").html(parseInt(J));$("#maxv").html(parseInt(x));document.getElementById("rangetext").style.display="";document.getElementById("loader").style.display="none";function U(X){var W=a.selectAll("g.arc").data(A,function(Z){return Z.label}),Y=W.enter();Y.append("text").attr("class","arc chord").attr("dy",".35em").attr("text-anchor",function(Z){return Z.angle>Math.PI?"end":null}).attr("transform",function(Z){return"rotate("+(Z.angle*180/Math.PI-90)+")translate("+(X+6)+")"+(Z.angle>Math.PI?"rotate(180)":"")}).text(function(Z){return Z.label.replace("_"," ")});Y.append("path").attr("id",function(Z){return"p_"+Z.label}).style("fill-opacity",0.8).style("stroke","#555").style("stroke-opacity",0.4).attr("d",function(aa,Z){return d3.svg.arc(aa,Z).innerRadius(X-20).outerRadius(X)(aa.source,Z)}).on("mouseover",function(Z){t=setTimeout(function(){I(Z.label,"MEMBER")},200)}).on("mouseout",function(Z){clearTimeout(t);M(Z.label,"MEMBER")});W.exit().remove()}function S(){var W=L.selectAll("g.node").data(N,function(Z,Y){return Z.cluster_id}),X=W.enter();X.append("circle").attr("class","node").attr("transform",function(Y){return"translate("+Y.x+","+Y.y+")"}).attr("r",function(Y){return Y.r}).attr("id",function(Y){return"c_"+Y.cluster_id}).style("fill-opacity",function(Y){return((Y.depth<1)?0:Y.opacity)}).style("fill",function(Y){return n}).style("stroke","#000").style("stroke-width",1.5).style("stroke-opacity",1).on("mouseover",function(Y){I(Y,"NODE")}).on("mouseout",function(Y){M(Y,"NODE")}).on("click",function(Z){if(!(Z.cluster_id in P)){var aa=[];var Y="";D[Z.cluster_id].relatedLinks.forEach(function(ab){aa.push(ab)});aa.sort(function(ac,ab){return((ac.name.toUpperCase()<ab.name.toUpperCase())?-1:1)});aa.forEach(function(ab){Y+="<tr><td>"+ab.name.replace("_"," ")+'</td><td class = "numeric">'+Number(ab.value).toLocaleString()+"</td></tr>"});if(Y){Y="<h3>Cluster #: "+Z.cluster_id+"</h3><h4>Members: "+Number(Z.member_count).toLocaleString()+"</h4><h4>Non-Unique Members: "+Number(Z.value).toLocaleString()+'</h4><table id = "popupdata" ><tr><th>Member</th><th>Paralogs</th></tr>'+Y+"</table>"}P[Z.cluster_id]=Y}$("#popup").html(P[Z.cluster_id]);$("#popup").modal({minHeight:400,overlayClose:true,containerCss:{width:500},onClose:function(ab){$.modal.close();$("#popup").empty()}})});W.exit().remove().transition(500).style("opacity",0)}function Q(){if(j){return}j=true;$("#ranged").noUiSlider({start:[J,x],step:1,direction:"ltr",behaviour:"tap-drag",connect:true,range:{min:[H[0]],max:[H[1]]},serialization:{lower:[$.Link({target:$("#minv-span"),method:"html"})],upper:[$.Link({target:$("#maxv-span"),method:"html"})],format:{mark:".",decimals:0}}});$("#ranged").change(function(){var W=$(this).val();if(J==W[0]&&x==W[1]){return}document.getElementById("loader").style.display="";document.getElementById("rangetext").style.display="none";F();b(W[0],W[1]);K();c()})}}function B(W){var U=3,V=0;document.getElementById("loader").style.display="";document.getElementById("rangetext").style.display="none";d3.json(W+"/members.json",S);d3.json(W+"/member_to_cluster.json",R);d3.json(W+"/clusters.json",Q);function T(){if(!(--U)){c()}}function S(Y,X){E=[];X.forEach(function(aa){var Z={name:aa};E.push(Z)});H=[1,E.length];b(Math.max(1,H[1]-3),H[1]);V++;if(V==2){K(m)}T()}function R(Z,Y){s=[];var X=0;Y.forEach(function(aa){s.push({Key:X++,cluster_id:aa[0],member_id:aa[1],value:aa[2]})});T()}function Q(Y,X){m=X;V++;if(V==2){K(m)}T()}}return{getJSONData:B}})();